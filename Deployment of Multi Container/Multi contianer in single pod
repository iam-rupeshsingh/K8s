Perfect! Let’s start fresh and go step by step for deploying your Node + MongoDB multi-container app in a single Pod in Kubernetes. I’ll include all YAML, explanations, and the correct localhost settings.
Step 0️⃣ Prerequisites
You need:
Kubernetes cluster (Minikube, kind, or any cluster)
kubectl configured to talk to your cluster
Docker image of your Node app pushed to a registry (Docker Hub)
Remember: In single Pod, Node app talks to MongoDB using localhost.
Step 1️⃣ Update Node app
In your server.js, set MongoDB connection to:
Copy code
Js
mongoose.connect("mongodb://localhost:27017/emailDB");
✅ Works because Node + Mongo are in same Pod
Save and rebuild Docker image
Push to Docker Hub
Copy code
Bash
docker build -t yourdockerhub/email-app:v1 .
docker push yourdockerhub/email-app:v1
Step 2️⃣ Write Kubernetes Deployment YAML
Create file: email-app-deployment.yaml
Copy code
Yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: email-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: email-app
  template:
    metadata:
      labels:
        app: email-app
    spec:
      containers:
        - name: node-app
          image: yourdockerhub/email-app:v1
          ports:
            - containerPort: 3000

        - name: mongo
          image: mongo:6.0
          ports:
            - containerPort: 27017
          # Optional: add environment variables for Mongo config if needed
✅ Notes:
Two containers in same Pod
Node app uses localhost to reach Mongo
MongoDB container uses default port 27017
Step 3️⃣ Create Kubernetes Service
We need a Service to expose Node app to browser:
Copy code
Yaml
apiVersion: v1
kind: Service
metadata:
  name: email-app-service
spec:
  selector:
    app: email-app
  type: LoadBalancer
  ports:
    - protocol: TCP
      port: 80       # External port
      targetPort: 3000  # Node app container port
✅ Notes:
Service selects Pod with label app=email-app
Type LoadBalancer allows external access (in Minikube it works via minikube service)
Step 4️⃣ Deploy to Kubernetes
Apply Deployment and Service:
Copy code
Bash
kubectl apply -f email-app-deployment.yaml
kubectl apply -f email-app-service.yaml
Check Pod:
Copy code
Bash
kubectl get pods
kubectl describe pod <pod-name>
You should see one Pod with two containers: node-app + mongo
Step 5️⃣ Access the app
If using Minikube:
Copy code
Bash
minikube service email-app-service
This will open a browser with the Node app.
✅ Node app talks to MongoDB via localhost, everything works.
Step 6️⃣ Verify Node <-> Mongo communication
Check logs of Node container:
Copy code
Bash
kubectl logs <pod-name> -c node-app
You should see MongoDB connected message.
Step 7️⃣ Key points / mental model
Copy code

Pod network namespace (single Pod)
+---------------------+
| Node container      |
| mongoose -> localhost:27017
|                     |
| Mongo container     |
+---------------------+
Node and Mongo share network & localhost
Only Node container is exposed externally
MongoDB remains internal
✅ Interview-ready explanation
“For a single Pod multi-container deployment, containers share the same network namespace. Node app can connect to MongoDB using localhost. Kubernetes Services expose only the Node container to external clients.”
